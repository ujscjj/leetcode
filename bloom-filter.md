### 布隆过滤器

#### 场景

假设需要处理这样一个问题，你有一个网站并且拥有很多访客，每当有用户访问时，你想知道这个 IP 是不是第一次访问你的网站。

#### hashtable可以吗

hashtable是一个显而易见的答案。但是题目说了有很多的访客，假如有10亿个用户访问过，假设 IP 是 IPV4，那么每个IP的长度是4 byte，那么一共需要 4 * 100000000 = 4000000000 Bytes = 4G.

如果判断URL是黑名单，由于每个URL会更长，那么需要的空间可能会远远大于你的期望。

#### bit

另一个稍难想到的解法是bit，我们知道bit有 0 和 1 两种状态，那么用来表示**存在**和**不存在**再合适不过了。

假如有10亿个 IP，就可以用10亿个 bit 来存储，那么一共需要 1 * 1000000000 = (4000000000 / 8) Bytes = 128 M，变为原来的1/32，如果是存储URL这种更长的字符串，效率会更高。

#### 布隆过滤器

布隆过滤器其实就是 bit + 多个散列函数。k次 hash(ip) 会生成多个索引，并将其k个索引位置的二进制置为1。如果经过k个索引位置的值都为1，那么认为其**可能存在**(因为有冲突的可能)；如果有一个不为1，那么**一定不存在**(一个值经过散列函数得到的值一定是唯一的)，这也是布隆过滤器的一个重要特点。

![](\pics\bloom-filter-url.png)

从上图可以看出，布隆过滤器本质上是**一个很长的二进制向量**和**多个哈希函数**组成。

由于没有hashtable的100%可靠性，因此这本质上是一种**可靠性换取空间的做法**。除了可靠性，布隆过滤器删除起来也比较麻烦。

#### 布隆过滤器

1. 网络爬虫

   > 判断某个URL是否已经被爬取过。

2. K-V数据库，判断某个key是否存在

   > 用于快速查询判断某个 key 在region中是否存在。

3. 钓鱼网站识别

   > 浏览器有时会警告用户，访问的网站很可能是钓鱼网站，用的就是这种技术。







